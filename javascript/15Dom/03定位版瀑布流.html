<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}
			
			ul,
			li {
				list-style: none;
			}
			
			#list {
				position: relative;
				margin: 0 auto;
				border: 1px solid red;
			}
			
			#list li {
				position: absolute;
				width: 200px;
				border: 1px solid lightgray;
				padding: 10px;
				visibility: hidden;
				transition: all 0.5s;
			}
			
			#list li img {
				width: 100%;
			}
		</style>
	</head>

	<body>
		<ul id="list">

		</ul>

		<script type="text/javascript">
			var oList = document.getElementById("list");
			
			createImg();

			function createImg() {
				for(var i = 1; i <= 20; i++) {
					var newImg = new Image();
					newImg.src = "../images/" + i + ".jpeg";

					var newLi = document.createElement("li");
					newLi.appendChild(newImg);
					oList.appendChild(newLi);
				}

			}

			//当浏览器的大小发生变化时
			window.onresize = function() {
				//改变图片的定位
				createFall();
			}

			//图片加载完成,再布局瀑布流,否则获取不到图片的高度
			window.onload = function() {
				//给所有的图片进行定位
				createFall();
			}

			//滚动到底部,图片再次加载
			window.onscroll = function() {
				var theTop = document.body.scrollTop;
				var winHeight = document.documentElement.clientHeight;
				var pageHeight = document.documentElement.scrollHeight;
				if((theTop + winHeight) / pageHeight > 0.9) {
					createImg();
					createFall();
				}
			}

			//创建瀑布流
			function createFall() {
				//获取所有的li 
				var lis = oList.children;
				var space = 10;

				//算有几列
				//获取页面宽度
				var winWidth = document.documentElement.clientWidth;
				//一个列的宽度
				var liWidth = lis[0].offsetWidth + space;
				//列数
				var cols = parseInt(winWidth / liWidth);

				oList.style.width = cols * liWidth + space + "px";

				var colsHeight = [];
				for(var i = 0; i < cols; i++) {
					colsHeight[i] = 0;
				}

				for(var i = 0; i < lis.length; i++) {
					//定义最小的列
					var minHeight = colsHeight[0];
					var minIndex = 0;

					for(var j = 0; j < colsHeight.length; j++) {
						if(minHeight > colsHeight[j]) {
							minHeight = colsHeight[j];
							minIndex = j;
						}
					}

					lis[i].style.left = liWidth * minIndex + space + "px";
					lis[i].style.top = minHeight + space + "px";
					lis[i].style.visibility = "visible";
					//更新高度
					colsHeight[minIndex] += lis[i].offsetHeight + space;

				}

				//找最大高度,给list高度,保证list占文本流

				var maxHeight = 0;

				for(var i = 0; i < colsHeight.length; i++) {
					if(maxHeight < colsHeight[i]) {
						maxHeight = colsHeight[i];

					}
				}
				oList.style.height = maxHeight + space + "px";

			}
		</script>
	</body>

</html>