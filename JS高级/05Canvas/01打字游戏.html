<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        html, body {
            height: 100%;
        }

        body {
            background-color: black;
        }
        div {
            color: white;
        }

        #content {
            position: absolute;
            width: 500px;
        }

        .game {
            position: absolute;
            left: 0;
            top: 0;
        }

        #start {
            background-color: white;
            border: 0;
            font-size: 20px;
            width: 80px;
            height: 30px;
        }


    </style>
</head>
<body>
<div id="content">
    <div class="game">
        <input type="button" name="start" id="start" value="开始"/>
        <span>分数:</span>
        <span id="score">0</span>
        <span>倒计时:</span>
        <span id="times">30</span>
    </div>
</div>
<canvas id="myCanvas"></canvas>
</body>

<script>

    var oBtn = document.getElementById("start");
    var oScore = document.getElementById("score");
    var oTime = document.getElementById("times");

    var oCanvas = document.getElementById("myCanvas");
    var ctx = oCanvas.getContext("2d");
    oCanvas.width = document.documentElement.clientWidth;
    oCanvas.height = document.documentElement.clientHeight;

//    随机函数
    function getRandom(min,max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
    }

    function Letter() {
        this.color = "red";
        this.fontSize = getRandom(30,50);
        this.x = getRandom(0,oCanvas.width - this.fontSize);
        this.y = 0;
        this.value = String.fromCharCode(getRandom(65,90));
        this.speed = getRandom(1,5);
    }

    Letter.prototype.draw = function () {

         ctx.beginPath();
//        "Bold 40Px Arial"
         ctx.font = "Bold " + this.fontSize + "px Arial";
        ctx.fillStyle = this.color;
        ctx.fillText(this.value,this.x,this.y);
    }

    Letter.prototype.move = function () {
        this.y += this.speed;
    }

//    判断是否清楚
    Letter.prototype.isClear = function () {
        if(this.y >= oCanvas.height){
            return true;
        }else{
            return false;
        }
    }
    var letterTimer = null;
    var letterArr =[];
    var index = 0;//定义计时器走过的次数
    oBtn.onclick = function () {
        var timer = setInterval(function () {
            oTime.innerHTML = oTime.innerHTML - 1;
            if(oTime.innerHTML == "0"){
                clearInterval(timer);
                clearInterval(letterTimer);
                alert("时间到啦,分数是:" + oScore.innerHTML);
//            重新加载页面
                window.location.reload();
            }
        },1000);

        letterTimer = setInterval(function () {
            ctx.clearRect(0,0,oCanvas.width,oCanvas.height);
            //定时器没走20次  创建一个字母
            if(index % 20 == 0){
                var letter = new Letter();
                letterArr.push(letter);
            }
            for(var i = 0; i < letterArr.length; i++){
                letterArr[i].move();
                if(letterArr[i].isClear()){
                    letterArr.splice(i,1);
                    i--;
                }else{
                    letterArr[i].draw();
                }
            }
            index++;
        },10);
    }

    document.onkeydown = function (e) {
        var e = e || window.event;
        var str = String.fromCharCode(e.keyCode);
        for(var i = 0; i < letterArr.length; i++){

        if(letterArr[i].value == str){
           letterArr.splice(i,1);
//            分数加一
            oScore.innerHTML = parseInt(oScore.innerHTML) + 1;
//            要删除的是 第一个下落相同的字母
            break;
        }else{
            oScore.innerHTML = oScore.innerHTML - 1;
        }
    }

    }



</script>

</html>