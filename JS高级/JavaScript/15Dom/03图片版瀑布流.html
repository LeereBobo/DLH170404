<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
			}
			
			ul li {
				list-style: none;
			}
			
			#list {
				position: relative;
				margin: 5px auto;
				border: 1px solid gray;
			}
			
			#list li {
				position: absolute;
				border: 1px solid black;
				padding: 10px;
				width: 200px;
				transition: all 2s;
				/*最初的时候隐藏*/
				visibility: hidden;
			}
			
			#list li img {
				width: 100%;
			}
		</style>
	</head>

	<body>

		<ul id="list">

		</ul>

		<script type="text/javascript">
			var oList = document.getElementById("list");

			function loadImg() {
				for(var i = 0; i < 30; i++) {
					var newImg = new Image();
					newImg.src = "image/" + i + ".jpg";
					var newLi = document.createElement("li");
					newLi.appendChild(newImg);
					oList.appendChild(newLi);
				}
			}
			loadImg();
			//当浏览器大小发生变化时
			window.onresize = function() {
				//				改变图片的定位

				createFall();

			}

			//图片加载完成,在布局瀑布流   否则获取不到图片的高度
			window.onload = function() {
				//给所有的图片进行定位

				createFall();
			}
			
			//页面滚动到底部的时候
			window.onscroll = function() {
				var winH = document.documentElement.clientHeight;
				var theTop = document.body.scrollTop;
				var pageH = document.documentElement.scrollHeight;

				if((winH + theTop) / pageH  >= 0.9) {
					loadImg();
					createFall();
					console.log("122");
				}
			}

			//创建瀑布流
			function createFall() {
				//获取所有的li
				var lis = oList.children;
				var space = 10;
				//算有几列
				//获取页面的宽度
				var winWidth = document.documentElement.clientWidth;
				//一个li的宽度
				var liWidth = lis[0].offsetWidth + space;

				//列数
				var cols = parseInt(winWidth / liWidth);
				oList.style.width = cols * liWidth + space + "px";

				var colsHeight = [];

				for(var i = 0; i < cols; i++) {
					colsHeight[i] = 0;
				}

				for(var i = 0; i < lis.length; i++) {
					//定义最小的列
					var minIndex = 0;
					var maxIndex = 0;
					var maxHeight = colsHeight[0];
					var minHeight = colsHeight[0];
					for(var j = 0; j < colsHeight.length; j++) {
						if(minHeight > colsHeight[j]) {
							minHeight = colsHeight[j];
							minIndex = j;
						}
						//找最大的高度,给list高度,保证list占文本流
						if(maxHeight < colsHeight[j]) {
							maxHeight = colsHeight[j];
							maxIndex = j;
						}
					}
					oList.style.height = maxHeight + 2 * space + "px";
					lis[i].style.left = minIndex * liWidth + space + "px";
					lis[i].style.top = minHeight + space + "px";
					lis[i].style.visibility = "visible";
					//更新高度
					colsHeight[minIndex] += lis[i].offsetHeight + space;

				}
			}
		</script>
	</body>

</html>