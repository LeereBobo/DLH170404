<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			html,body,ul,li{
				margin:0;
				padding:0;
			}
			ul,li{
				list-style: none;
			}
			#list{
				position: relative;
				margin:0 auto;
			}
			#list>li{
				border:1px solid darkgray;
				width:188px;
				padding:5px;
				position:absolute;
				top:0;
				left:0;
				transition: all 1s;
			}
			#list>li>img{
				width:100%;
			}
		</style>
	</head>
	<body>
	<ul id="list"></ul>
	
	<script type="text/javascript">
		var oList = document.getElementById("list");
		var oLis = document.getElementsByTagName("li");
		var imgs = ["image/1.jpg","image/2.jpg","image/3.jpg","image/4.jpg",
		"image/5.jpg","image/6.jpg","image/7.jpg","image/8.jpg","image/9.jpg",
		"image/10.jpg","image/11.jpg","image/12.jpg","image/13.jpg","image/14.jpg",
		"image/15.jpg","image/16.jpg","image/17.jpg","image/18.jpg","image/19.jpg",
		"image/20.jpg"];
		var colw = 200;//每列的宽
		var margin = 10;//外边距
		
//		//获取浏览器可视窗口的可视宽度
//		var innerW = document.documentElement.clientWidth;
//		
//		var cols = parseInt(innerW / (colw + margin));//计算列数
//		
//		 oList.style.width = cols * (colw + margin) - margin + "px";//计算ul的宽度
		
		var colsH = [];//记录每列高度数组
		
//		//初始化高度数组
//		for(var i = 0 ; i < cols; i++){
//			colsH[i] = 0;
//		}
		
		//加载图片
		function loadimg (){
			for(var i = 0; i < imgs.length;i++){
				var newLi = document.createElement("li");
				var newImg = new Image();
				newImg.src = imgs[i];
				newLi.style.opacity = 0;
				newLi.appendChild(newImg);
				oList.appendChild(newLi);
			}
		}
		loadimg();
		
		//生成瀑布流
		function createfall(){
			//获取浏览器可视窗口的可视宽度
		var innerW = document.documentElement.clientWidth;
		
		var cols = parseInt(innerW / (colw + margin));//计算列数
		
		 oList.style.width = cols * (colw + margin) - margin + "px";//计算ul的宽度
		 
		 //初始化高度数组
		for(var i = 0 ; i < cols; i++){
			colsH[i] = 0;
		}
		
			for(var i = 0 ; i < oLis.length; i++ ){
				//获取最短列的下标
				var minIndex = getMinIndex();
				//设置li 的 top 和 left的值
				oLis[i].style.top = colsH[minIndex] + margin + "px";
				oLis[i].style.left = (colw + margin) * minIndex + "px";
				oLis[i].style.opacity = 1;
				
				//更新列的高度
				colsH[minIndex] +=margin + oLis[i].offsetHeight;
			}
		}
		
		
		//计算最短列的下标
		function getMinIndex(){
			var minIndex = 0 ;
			var minH = colsH[0];
			for(var i = 0 ; i < colsH.length; i++){
				if(minH > colsH[i]){
					minH = colsH[i];
					minIndex = i;
				}
			}
			return minIndex;
		}
		
		window.onload = function(){
			createfall();
			
		}
		//窗口调大或者调小时的事件
		window.onresize = function(){
			createfall();
		}
		window.onscroll = function(){
			//获取滚动偏移量
			var sTop = document.body.scrollTop||document.documentElement.scrollTop;
			var winH = document.documentElement.clientHeight;
			//获取页面的整体高度
			var pageH = document.documentElement.scrollHeight;
			if(sTop + winH == pageH){
				loadimg();
				createfall();
			}
		}
		
	</script>
	</body>
</html>
